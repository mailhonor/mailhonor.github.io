---
layout: wiki
title: LIBZC, map查询表
---

<H2>map查询表简介</H2>
<p> libzc支持查询表,效果类似postfix的查询表机制.
libzc的查询表类型包括 memcache,redis,socket,postproxy,flat,line,static

<p>先来一个查询表的列子
<pre>
memcache:127.0.0.1:11211&amp;prefix_&amp;suffix, redis:192.168.1.99:8002&amp;key, flat:/etc/mail/smap.txt, static:this_is_result
</pre>

<H3>memcache</H3>
<p> 配置语法为:
<pre>
memcache:192.168.0.1:11211&amp;前缀&amp;后缀
</pre>
<p>如查询年关键字为<B>eevp</B>, 则memcache的键值为 <B>前缀eevp后缀</B>, 命令行为:
<pre>
get <B>前缀eevp后缀</B>
</pre>

<H3>redis</H3>
<p> 配置语法为:
<pre>
redis:192.168.1.99:8008&amp;键值
</pre>
<p>如查询年关键字为<B>eevp</B>, 则相当于redis的hash命令中的hget, 命令行为:
<pre>
hget <B>键值 eevp</B>
</pre>

<H3>socket</H3>
<p> 配置语法为:
<pre>
socket:192.168.1.99:8008&amp;模块
</pre>
<p>如查询年关键字为<B>eevp</B>, 则相当于socket通信:
<pre>
<B>模块 eevp\r\n</B>
</pre>
<p>返回值为:
<pre>
#有查询结果
200 查询 ... ... 结果\r\n
</pre>
<p>或
<pre>
#没有查询结果
500\r\n
</pre>
<p>或
<pre>
#出错
400 错误 ... ... 信息\r\n
</pre>

<H3>flat</H3>
<p> 配置语法为:
<pre>
flat:/somepath/some.../someflat.txt
</pre>
<p>someflat.txt是一个text文件,内容形如
<pre>
abc abc_value
键名 键值
城市 北京
爱好 linux   等等
</pre>
<p>即, 第一列为查询值,其余为结果.
<p>flat查询表速度快.后台会把someflat.txt加载到内存,生成一个词典.如果修改了someflat.txt则需要重新加载.

<H3>line</H3>
<p> 配置语法为:
<pre>
line:192.168.1.99:8008
</pre>
<p>如查询年关键字为<B>eevp</B>, 则相当于socket通信:
<pre>
<B>eevp\r\n</B>
</pre>
<p>返回值为:
<pre>
#查询结果
查询 ... ... 结果\r\n
</pre>

<H3>static</H3>
<p> 配置语法为:
<pre>
static:返回值
</pre>
<p>查询任何关键字,返回结果都是固定的: "返回值"

<H3>postproxy</H3>
<p>postproxy支持postfix的查询表类型,类似postfix的proxy方式
<p> 配置语法为:
<pre>
postproxy:/var/spool/postfix/private/postmap:postfix查询表
</pre>
<p>postfix有查询表
<pre>
proxy:mysql:/etc/postfix/some_mysql_table.cf
</pre>
<p>则可配置为:
<pre>
postproxy:/var/spool/postfix/private/postmap&amp;mysql:/etc/postfix/some_mysql_table.cf
</pre>

<p>当然也可以这么用(小技巧),在postfix的master.cf中配置,增加
<pre>
192.168.1.99:20028  inet  -       -       n       -       -       proxymap
 -oproxy_read_maps=mysql:/etc/postfix/some_mysql_table.cf,...,,,,
</pre>
<p>则,我们可以这么利用postfix查询表

<pre>
postproxy:192.168.1.99:20028&amp;mysql:/etc/postfix/some_mysql_table.cf
</pre>

<H2>map_search测试工具</H2>
<p>map_search是一个map查询表测试工具,用法
<pre>
./map_search -m "查询表1,查询表2,..." -q 查询值
</pre>
<p>例子,查询<B>eevp</B> :
<pre>
./map_search -m "memcache:127.0.0.1:11211&amp;prefix_&amp;suffix, redis:192.168.1.99:8002&amp;key, flat:/etc/mail/smap.txt, static:this_is_result" -q eevp
</pre>
